#parse("/templates/$!{templateName}/inc/header.vm")
#set($logModeration = $moderationLoggingEnabled && $isEdit&& $isModerator && $user.id != $post.userId)
#set($allowPoll = $setType&& $canCreatePolls)

<script type="text/javascript">
var CONTEXTPATH = "${contextPath}";
var SERVLET_EXTENSION  = "${extension}";
</script>

<style type="text/css">@import url( ${contextPath}/templates/${templateName}/styles/tabs.css?${startupTime} );</style>
<style type="text/css">@import url( ${contextPath}/templates/${templateName}/styles/SyntaxHighlighter.css?${startupTime} );</style>
<script type="text/javascript" src="${contextPath}/templates/${templateName}/js/jquery.js?${startupTime}"></script>
<script type="text/javascript" src="${contextPath}/templates/${templateName}/js/post.js?${startupTime}"></script>
<script type="text/javascript">
#include("/templates/$!{templateName}/js/bbcode_help.js")
#include("/templates/$!{templateName}/js/utils.js")
#include("/templates/$!{templateName}/js/attachments.js")
</script>

<script type="text/javascript">
<!--
function newCaptcha()
{
	document.getElementById("captcha_img").src = "${contextPath}/jforum${extension}?module=captcha&action=generate&timestamp=" + new Date().getTime();
}

function validatePostForm(f)
{
	#if($setType)
	if (f.subject.value == "") {
		alert("${I18n.getMessage("PostForm.subjectEmpty")}");
		f.subject.focus();
		
		return false;
	}
	#end
	
	if (f.message.value.replace(/^\s*|\s*$/g, "").length == 0) {
		alert("${I18n.getMessage("PostForm.textEmpty")}");
		f.message.focus();
		
		return false;
	}

	if (f.toUsername.value == "") {
		alert("${I18n.getMessage("PrivateMessage.toUserIsEmpy")}");
		f.toUsername.focus();

		return false;
	}

	#if($logModeration)
	if (f.log_description.value == "") {
		alert("${I18n.getMessage("ModerationLog.reasonIsEmpty")}");
		f.log_description.focus();

		return false;
	}
	#end
	
	$("#icon_saving").css("display", "inline");
	$("#btnPreview").attr("disabled", "disabled");
	$("#btnSubmit").attr("disabled", "disabled").val("${I18n.getMessage("PostForm.saving")}...");
	
	return true;
}

function openFindUserWindow()
{
	var w = window.open("/pm/findUser")}", "_findUser", "height=250,resizable=yes,width=400");
	w.focus();
}

function smiliePopup()
{
	var w = window.open("/posts/listSmilies")}", "smilies", "width=300, height=300, toolbars=no, scrollbars=yes");
	w.focus();
}

-->
</script>

#if($maxAttachments)
	<#set($maxAttachments = 0)
#end

#set($htmlChecked = "checked=\"checked\"")
#set($bbChecked = "")
#set($signatureChecked = "checked=\"checked\"")
#set($repliesChecked = "checked=\"checked\"")
#set($smiliesChecked = "")

#if($isNewPost && !$spreview)
	#if(!$user.isHtmlEnabled())#set($htmlChecked = "")#end
	#if(!$user.isBbCodeEnabled())#set($bbChecked = "checked=\"checked\"")#end
	#if(!$user.isSmiliesEnabled())#set($smiliesChecked = "checked=\"checked\"")#end
	#if(!$user.getAttachSignatureEnabled())#set($signatureChecked = "")#end
#else
	#if(!$post.isHtmlEnabled())#set($htmlChecked = "")#end
	#if(!$post.isBbCodeEnabled())#set($bbChecked = "checked=\"checked\"")#end
	#if(!$post.isSmiliesEnabled())#set($smiliesChecked = "checked=\"checked\"")#end
	#if(!$post.isSignatureEnabled())#set($signatureChecked = "")#end
#end

#if(!$user.isNotifyOnMessagesEnabled())#set($repliesChecked = "")#end

<form action="/jforum")}" method="post" enctype="multipart/form-data" name="post" id="post" onsubmit="return validatePostForm(this)">
<input type="hidden" name="action" value="${action}" />
<input type="hidden" name="module" value="${moduleName}" />
<input type="hidden" name="preview" value="0"/>
#if($forum)<input type="hidden" name="forum_id" value="${forum.id}" />#end
<input type="hidden" name="start" value="${start}" />
#if($isEdit)<input type="hidden" name="post_id" value="${post.id}" />#end
#if($!isNewTopic)<input type="hidden" name="topic_id" value="${topic.id}" />#end
<div id="nav">
	<a class="nav" href="${contextPath}/index.html")}">${I18n.getMessage("ForumListing.forumIndex")}</a>

	#if($forum)
	&raquo; <a class="nav" href="${contextPath}/forum-${forum.id}.html">${forum.name}</a>
	#end
</div>
<DIV class="mainbox viewtopic">
	<H1>
		#if($forum)
				#if($topic)
				    #if($isEdit)
				    	${I18n.getMessage("PostForm.edit")} "${topic.title}"
				    #else
						${I18n.getMessage("PostForm.reply")} "${topic.title}"
					#end
				#else
					${I18n.getMessage("PostForm.title")}
				#end
			<#else>
				#if($pmReply)
					${I18n.getMessage("PrivateMessage.reply")}
				#else
					${I18n.getMessage("PrivateMessage.title")}
				#end
		#end
	</H1>
	<table class="mainbox" cellspacing="1" cellpadding="3" width="100%" border="0">
		#if(!$forum)
			<tr>
				<td class="row1" width="15%"><span class="gen"><b>${I18n.getMessage("PrivateMessage.user")}</b></span></td>
				<td class="row2" width="85%">
					#if($pmRecipient)
						#set($toUsername = $toUsername)
						#set($toUserId = $toUserId)
					#elseif($preview)
						#set($toUsername = $pm.toUser.username)
						#set($toUserId = $pm.toUser.id)
					#elseif($quote == "true" || $pmReply)
						#set($toUsername = $pm.fromUser.username)
						#set($toUserId = $pm.fromUser.id)
					#else
						#set($toUsername = "")
						#set($toUserId = "")
					#end
	
					<input type="text" class="post" size="25" name="toUsername" value="${toUsername}"/>&nbsp;
					<input type="button" value="${I18n.getMessage("PrivateMessage.findUser")}" name="findUser" class="liteoption" onclick="openFindUserWindow(); return false;" />
					<input type="hidden" name="toUserId" value="${toUserId}" />
				</td>
			</tr>
		#end
	
		#if($errorMessage)
			<tr>
				<td colspan="2" align="center"><span class="gen"><font color="#ff0000"><b>${errorMessage}</b></font></span></td>
			</tr>
		#end
	
		<tr>
			<td class="row1" width="15%"><span class="gen"><b>${I18n.getMessage("PostForm.subject")}</b></span></td>
			#if($post)
				#set($subject = $post.subject)
			#elseif($pmReply)
				#set($subject = $pm.post.subject)
			#elseif($topic)
				#set($subject = $I18n.getMessage("Message.replyPrefix") + $topic.title)
			#end
			<td class="row2" width="100%">
				<input width="100%" class="subject" type="text" tabindex="2" maxlength="100" name="subject" value="${subject}" />
			</td>
		</tr>
	
		<tr>
			<!-- Smilies -->
			<td class="row1" valign="top">
				<div id="smilieslist">
		  			<h4><span>${I18n.getMessage("PostForm.body")}</span></h4>
							<table cellspacing="0" cellpadding="5" width="100" border="0">
								<tr align="center">
									<td align="left" class="gensmall" colspan="4"><b>${I18n.getMessage("PostForm.emoticons")}</b></td>
								</tr>
								#set($count = 0)
								#set($lastSmilie = "")
								#foreach($smilie in $smilies)
										#if($count < 20)
											#if($lastSmilie == "" || $lastSmilie.url != $smilie.url)
												#if($count % 4 == 0)
													<tr>
												#end
												<td><a href="javascript:emoticon('${smilie.code}');">${smilie.url}</a></td>
												#set($count = $count + 1)
												#if($count % 4 == 0)
													</tr>
												#end
												#set($lastSmilie = $smilie)
											#end
										#end
								#end
	
									#if(!($count % 4 == 0))
									#end
								<tr align="center">
									<td colspan="4">
										<span class="nav"><a href="#" onclick="smiliePopup();return false;">${I18n.getMessage("PostForm.moreSmilies")}</a></span>
									</td>
								</tr>
							</table>
					</div>
			</td>
	
			<!-- BB Codes, textarea -->
			<td class="row2" valign="top">
				<div class="gen">
					<table cellspacing="0" cellpadding="2" border="0" width="100%">
						<!-- bb code -->
						<tr valign="middle">
							<td>
								<input class="button" onmouseover="helpline('b')" style="FONT-WEIGHT: bold; WIDTH: 30px" accesskey="b" onclick="bbstyle(0)" type="button" value=" B " name="addbbcode0" /> 
								<input class="button" onmouseover="helpline('i')" style="WIDTH: 30px; FONT-STYLE: italic" accesskey="i" onclick="bbstyle(2)" type="button" value=" i " name="addbbcode2" /> 
								<input class="button" onmouseover="helpline('u')" style="WIDTH: 30px; TEXT-DECORATION: underline" accesskey="u" onclick="bbstyle(4)" type="button" value=" u " name="addbbcode4" />
								<input class="button" onmouseover="helpline('q')" style="WIDTH: 50px" accesskey="q" onclick="bbstyle(6)" type="button" value="Quote" name="addbbcode6" /> 
								<input class="button" onmouseover="helpline('c')" style="WIDTH: 40px" accesskey="c" onclick="bbstyle(8)" type="button" value="Code" name="addbbcode8" />
								<input class="button" onmouseover="helpline('l')" style="WIDTH: 40px" accesskey="l" onclick="bbstyle(10)" type="button" value="List" name="addbbcode10" />
								<input class="button" onmouseover="helpline('p')" style="WIDTH: 40px" accesskey="p" onclick="bbstyle(12)" type="button" value="Img" name="addbbcode12" />
								<input class="button" onmouseover="helpline('w')" style="WIDTH: 40px" accesskey="w" onclick="bbstyle(14)" type="button" value="URL" name="addbbcode14" />
								<input class="button" onmouseover="helpline('g')" style="WIDTH: 50px" accesskey="g" onclick="bbstyle(16)" type="button" value="Google" name="addbbcode16" />
								<input class="button" onmouseover="helpline('y')" style="WIDTH: 60px" accesskey="y" onclick="bbstyle(18)" type="button" value="Youtube" name="addbbcode18" />
								<input class="button" onmouseover="helpline('k')" style="WIDTH: 40px" accesskey="k" onclick="bbstyle(20)" type="button" value="Flash" name="addbbcode20" />
								<input class="button" onmouseover="helpline('v')" style="WIDTH: 40px" accesskey="v" onclick="bbstyle(22)" type="button" value="WMV" name="addbbcode22" />
							</td>
						</tr>
						
						<!-- Color, Fonts -->
						<tr>
							<td>
								<span class="genmed">&nbsp;${I18n.getMessage("PostForm.textColor")}: 
								<select onmouseover="helpline('s')" onchange="bbfontstyle('[color=' + this.form.addbbcode24.options[this.form.addbbcode24.selectedIndex].value + ']', '[/color]')" name="addbbcode24"> 
									<option class="genmed" style="COLOR: black; BACKGROUND-COLOR: #fafafa" value="#444444" selected="selected">${I18n.getMessage("PostForm.colorDefault")}</option> 
									<option class="genmed" style="COLOR: darkred; BACKGROUND-COLOR: #fafafa" value="darkred">${I18n.getMessage("PostForm.colorDarkRed")}</option> 
									<option class="genmed" style="COLOR: red; BACKGROUND-COLOR: #fafafa" value="red">${I18n.getMessage("PostForm.colorRed")}</option> 
									<option class="genmed" style="COLOR: orange; BACKGROUND-COLOR: #fafafa" value="orange">${I18n.getMessage("PostForm.colorOrange")}</option> 
									<option class="genmed" style="COLOR: brown; BACKGROUND-COLOR: #fafafa" value="brown">${I18n.getMessage("PostForm.colorBrown")}</option> 
									<option class="genmed" style="COLOR: yellow; BACKGROUND-COLOR: #fafafa" value="yellow">${I18n.getMessage("PostForm.colorYellow")}</option> 
									<option class="genmed" style="COLOR: green; BACKGROUND-COLOR: #fafafa" value="green">${I18n.getMessage("PostForm.colorGreen")}</option> 
									<option class="genmed" style="COLOR: olive; BACKGROUND-COLOR: #fafafa" value="olive">${I18n.getMessage("PostForm.colorOlive")}</option> 
									<option class="genmed" style="COLOR: cyan; BACKGROUND-COLOR: #fafafa" value="cyan">${I18n.getMessage("PostForm.colorCyan")}</option> 
									<option class="genmed" style="COLOR: blue; BACKGROUND-COLOR: #fafafa" value="blue">${I18n.getMessage("PostForm.colorBlue")}</option> 
									<option class="genmed" style="COLOR: darkblue; BACKGROUND-COLOR: #fafafa" value="darkblue">${I18n.getMessage("PostForm.colorDarkBlue")}</option> 
									<option class="genmed" style="COLOR: violet; BACKGROUND-COLOR: #fafafa" value="violet">${I18n.getMessage("PostForm.colorViolet")}</option> 
									<option class="genmed" style="COLOR: white; BACKGROUND-COLOR: #fafafa" value="white">${I18n.getMessage("PostForm.colorWhite")}</option>
									<option class="genmed" style="COLOR: black; BACKGROUND-COLOR: #fafafa" value="black">${I18n.getMessage("PostForm.colorBlack")}</option>
								</select> 
	
								&nbsp;${I18n.getMessage("PostForm.font")}:
								<select onmouseover="helpline('f')" onchange="bbfontstyle('[size=' + this.form.addbbcode26.options[this.form.addbbcode26.selectedIndex].value + ']', '[/size]')" name="addbbcode26"> 
									<option class="genmed" value="7">${I18n.getMessage("PostForm.fontVerySmall")}</option> 
									<option class="genmed" value="9">${I18n.getMessage("PostForm.fontSmall")}</option> 
									<option class="genmed" value="12" selected="selected">${I18n.getMessage("PostForm.fontNormal")}</option> 
									<option class="genmed" value="18">${I18n.getMessage("PostForm.fontBig")}</option> 
									<option class="genmed" value="24">${I18n.getMessage("PostForm.fontGiant")}</option>
								</select> 
								</span>
								<span class="gensmall"><a class="genmed" onmouseover="helpline('a')" href="javascript:bbstyle(-1)">${I18n.getMessage("PostForm.closeMarks")}</a></span>
								<!-- Help box -->
								<input name="helpbox" class="helpline" readonly="readonly" style="FONT-SIZE: 10px; " value="${I18n.getMessage("PostForm.helplineTip")}" size="45" maxlength="100" />
							</td>
						</tr>
						<!-- Textarea -->
						<tr>
							<td valign="top">
								<textarea  onkeyup="storeCaret(this);" onclick="storeCaret(this);" onselect="storeCaret(this);" tabindex="3" name="message" rows="15"  cols="70" width="100%">#if($post)#if($quote)[quote=${quoteUser}]${post.text}[/quote]#else${post.text}#end#end</textarea> 
							</td>
						</tr>
					</table>
				</div> 
			</td>
		</tr>
	
		<!-- Options -->
		<tr>
			<td class="row1">&nbsp;</td>
			<td class="row2">
				<div id="tabs10">
					<ul>
					    <li target="postOptions"><a href="javascript:void(0);" onClick="activateTab('postOptions', this);"><span>Options</span></a></li>
	
						#if($allowPoll)
							<li target="postPoll"><a href="javascript:void(0);" onClick="activateTab('postPoll', this);"><span>${I18n.getMessage("PostForm.pollQuestion")}</span></a></li>
						#end
						#if($attachmentsEnabled)
						    <li target="postAttachments"><a href="javascript:void(0);" onClick="activateTab('postAttachments', this);"><span>Attachments</span></a></li>
						#end
					</ul>
				</div>
	
				<!-- Post Options -->
				#parse("/templates/$!{templateName}/inc/postOptionsTab.vm")
	
				<!-- Poll tab -->
				#if($allowPoll)
					<div id="postPoll" class="postTabContents" style="display: none;">
						<div>
							<#include "post_poll_tab.htm"/>
						</div>
					</div>
				#end
	
				<!-- Attachments tab -->
				#if($attachmentsEnabled || $attachments)
					<div id="postAttachments" class="postTabContents" style="display: none; ">
						<div>
							#include("/templates/$!{templateName}/inc/post_attachments_tab.htm")
						</div>
					</div>
				#end
			</td>
		</tr
	
		#if($needCaptcha)
			<tr>
				<td class="row1" valign="middle"><span class="gensmall"><b>${I18n.getMessage("User.captchaResponse")}:</b></span></td>
				<td class="row2">
					<input type="text" class="post" style="width: 100px; font-weight: bold;" maxlength="25" size="25" name="captcha_anwser" /> 
					<img src="/captcha/generate/${timestamp}")}" border="0" align="middle" id="captcha_img" alt="Captcha unavailable" />
					<br />
					<span class="gensmall">${I18n.getMessage("User.hardCaptchaPart1")} <a href="#newCaptcha" onClick="newCaptcha()"><b>${I18n.getMessage("User.hardCaptchaPart2")}</b></a></span>
				</td>
			</tr>
		#end
	
		#if($logModeration)
			<tr>
				<td align="center" class="row1 gen"><b>${I18n.getMessage("ModerationLog.moderationLog")}</b></td>
				<td class="row2 genmed">${I18n.getMessage("ModerationLog.changeReason")} <input type="text" name="log_description" size="50" /><input type="hidden" name="log_type" value="2" /></td>
			</tr>
		#end
	
		#if($error)
			<tr>
				<td class="row1">&nbsp;</td>
				<td class="row2"><span class="gen"><font color="red"><b>${error}</b></font></span></td>
			</tr>
		#end
		
		<tr>
		<td/>
			<td align="left" height="28" colspan="2" class="catbottom">
				<input class="submit" id="btnPreview" tabindex="5" type="button" value="${I18n.getMessage("PostForm.preview")}" onclick="previewMessage();" />&nbsp;
				<input class="submit" id="btnSubmit" accesskey="s" tabindex="6" type="submit" value="${I18n.getMessage("PostForm.submit")}" name="post" />
			</td>
		</tr>
	</table>
</div>
<DIV class="mainbox viewtopic">
	<table class="mainbox" width="100%" cellspacing="1" cellpadding="4" border="0" #if($!preview)style="display: none"#end id="previewTable">
		<tr>
			<td class="row1">
			<h1>${I18n.getMessage("PostForm.preview")}</h1>
				<img src="${contextPath}/templates/${templateName}/images/icon_minipost.gif" alt="Post" />
				<span class="postdetails" id="previewSubject"> ${I18n.getMessage("PostForm.subject")}: #if($postPreview)${postPreview.subject}#end</span>
			</td>
		</tr>
		<tr>
			<td class="row1" height="100%">
				<span id="previewMessage" class="postbody">#if($postPreview)${postPreview.text}#end</span>
			</td>
		</tr>
	</table>
</div>
<script type="text/javascript">
<!--
#if($attachments)
	ignoreStart = true;
	editAttachments();
#end

#if($preview)document.location = "#preview";#end
-->
</script>

</form>
#include("/templates/$!{templateName}/inc/highlighter_js.htm")
#parse("/templates/$!{templateName}/inc/bottom.vm")